function startPlayer(frame) {
  var iframe = $(frame)[0], player = $f(iframe);
  player.api("play");
}

function pausePlayer(frame) {
  var iframe = $(frame)[0], player = $f(iframe);
  if (Modernizr.postmessage) player.api("pause"); else {
    var src = $("#video-popup iframe").attr("src");
    $("#video-popup iframe").attr("src", ""), $("#video-popup iframe").attr("src", src);
  }
}

function initializeStudyMap() {
  $(".study-map li").each(function() {
    var li = $(this), num = li.find("> ol > li").size();
    num > 0 && li.addClass("hasChildren");
    var status_yes = '<a href="#" class="status" rel="tooltip" title="Done!"></a>', status_no = '<a href="#" class="status" rel="tooltip" title="Not started">!</a>', status_part = '<a href="#" class="status" rel="tooltip" title="' + (num - 1) + " of " + num + ' items finished"></a>';
    if (li.hasClass("yes")) {
      li.find("> span").after(status_yes);
      return;
    }
    if (li.hasClass("no")) {
      li.find("> span").after(status_no);
      return;
    }
    if (li.hasClass("part")) {
      li.find("> span").after(status_part);
      return;
    }
    return;
  }), $(".study-map a.status").tooltip({
    delay: {
      show: 200,
      hide: 100
    }
  }), $(".study-map li a").click(function(e) {
    var a = $(this), li = a.parent(), href = a.attr("href");
    if (href !== "#" && href !== "" && href !== null) {
      window.location = href;
      return;
    }
    e.preventDefault(), li.hasClass("open") ? li.find("> ol").slideUp(100, function() {
      li.removeClass("open");
    }) : li.find("> ol").slideDown(100, function() {
      li.addClass("open");
    });
  });
}

$(function() {
  $("div.modal").modal({
    show: !1
  }), $("a.modal-video").on("click", function(e) {
    startPlayer("#video-popup iframe");
  }), $("#video-popup .modal-footer").on("click", ".btn-closeVid", function(e) {
    pausePlayer("#video-popup iframe");
  }), $("body").on("click", ".modal-backdrop", function(e) {
    pausePlayer("#video-popup iframe");
  }), initializeStudyMap(), $(window).resize(function() {
    log($(window).width());
  });
  var signinStart = $("#sign-in").css("top"), signinStop = "-5px";
  $("p.sign-in").on("click", "a", function(e) {
    $("#sign-in").animate({
      top: signinStop
    }, 300, "easeInOutQuart", function() {
      $("#sign-in").toggleClass("show");
    });
  }), $("#sign-in").on("click", "a.close-signin", function(e) {
    $("#sign-in").animate({
      top: signinStart
    }, 300, "easeInOutQuart", function() {
      $("#sign-in").toggleClass("show");
    });
  });
});